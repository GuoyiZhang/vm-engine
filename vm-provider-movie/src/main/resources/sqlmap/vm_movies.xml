<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.vm.movie.dao.mapper.VmMoviesMapper">
<resultMap type="com.vm.movie.dao.po.VmMovies"  id="VmMoviesMap">
  <id column="id" property="id"/>
  <result column="name" property="name"/>
  <result column="alias" property="alias"/>
  <result column="description" property="description"/>
  <result column="director_id" property="directorId"/>
  <result column="release_time" property="releaseTime"/>
  <result column="score" property="score"/>
  <result column="watch_num" property="watchNum"/>
  <result column="movie_time" property="movieTime"/>
  <result column="poster_url" property="posterUrl"/>
  <result column="img_url" property="imgUrl"/>
  <result column="status" property="status"/>
  <result column="create_time" property="createTime"/>
  <result column="update_time" property="updateTime"/>
</resultMap>

    <sql id="BASE_ALL_CLOUM">
        id,
        <include refid="BASE_COLUM_WITHOUT_ID"/>
    </sql>

	<sql id="BASE_COLUM_WITHOUT_ID">
		name,
		alias,
		description,
		director_id,
		release_time,
		score,
		watch_num,
		movie_time,
		poster_url,
		img_url,
		status,
		create_time,
		update_time
	</sql>



	<select id="count" resultType="int">
		SELECT 
			count(1)
		FROM
		vm_movies
		<include refid="queryCondition" />
	</select>

<insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO vm_movies(
        <include refid="BASE_COLUM_WITHOUT_ID"/>
        )
        VALUES (
#{name},
#{alias},
#{description},
#{directorId},
#{releaseTime},
#{score},
#{watchNum},
#{movieTime},
#{posterUrl},
#{imgUrl},
#{status},
#{createTime},
#{updateTime}
       )
				 </insert>

<delete id="delete">
		DELETE
		FROM
			vm_movies
		WHERE
			id = #{id}
	</delete>

<update id="update" parameterType="com.vm.movie.dao.po.VmMovies" >
UPDATE
		vm_movies
<set>
<if test="name != null">name=#{name},</if>
<if test="alias != null">alias=#{alias},</if>
<if test="description != null">description=#{description},</if>
<if test="directorId != null">director_id=#{directorId},</if>
<if test="releaseTime != null">release_time=#{releaseTime},</if>
<if test="score != null">score=#{score},</if>
<if test="watchNum != null">watch_num=#{watchNum},</if>
<if test="movieTime != null">movie_time=#{movieTime},</if>
<if test="posterUrl != null">poster_url=#{posterUrl},</if>
<if test="imgUrl != null">img_url=#{imgUrl},</if>
<if test="status != null">status=#{status},</if>
<if test="createTime != null">create_time=#{createTime},</if>
<if test="updateTime != null">update_time=#{updateTime}</if>
</set>
WHERE
id=#{id}
</update>


	<select id="selectList" resultMap="VmMoviesMap">
		SELECT
			<include refid="BASE_ALL_CLOUM"/>
		FROM
		vm_movies
		<include refid="queryCondition" />
		LIMIT #{start},#{size}

	</select>

	<select id="selectListOrderBy" resultMap="VmMoviesMap">
		SELECT
			<include refid="BASE_ALL_CLOUM"/>
		FROM
		vm_movies
		<include refid="queryCondition" />
	<if test="orderBy != null and orderType != null">
			order by ${orderBy} ${orderType}
		</if>
		limit #{start},#{size}

	</select>

<sql id="queryCondition">
<trim prefix="where" prefixOverrides="and">
<if test="query != null">
<if test="query.name != null ">
		and name=#{query.name}
</if>
<if test="query.alias != null ">
		and alias=#{query.alias}
</if>
<if test="query.description != null ">
		and description=#{query.description}
</if>
<if test="query.directorId != null ">
		and director_id=#{query.directorId}
</if>
<if test="query.releaseTime != null ">
		and release_time=#{query.releaseTime}
</if>
<if test="query.score != null ">
		and score=#{query.score}
</if>
<if test="query.watchNum != null ">
		and watch_num=#{query.watchNum}
</if>
<if test="query.movieTime != null ">
		and movie_time=#{query.movieTime}
</if>
<if test="query.posterUrl != null ">
		and poster_url=#{query.posterUrl}
</if>
<if test="query.imgUrl != null ">
		and img_url=#{query.imgUrl}
</if>
<if test="query.status != null ">
		and status=#{query.status}
</if>
<if test="query.createTime != null ">
		and create_time=#{query.createTime}
</if>
<if test="query.updateTime != null ">
		and update_time=#{query.updateTime}
</if>
</if>
</trim>
</sql>


<insert id="batchInsert"  useGeneratedKeys="true" parameterType="java.util.List" keyProperty="id">
        INSERT INTO vm_movies(
        <include refid="BASE_COLUM_WITHOUT_ID"/>
)        VALUES 
   <foreach collection ="list" item ="item" index ="index" separator =","> 
(
#{item.name},
#{item.alias},
#{item.description},
#{item.directorId},
#{item.releaseTime},
#{item.score},
#{item.watchNum},
#{item.movieTime},
#{item.posterUrl},
#{item.imgUrl},
#{item.status},
#{item.createTime},
#{item.updateTime}
)
</foreach> 
</insert>


    <select id="select" resultMap="VmMoviesMap">
        SELECT * FROM vm_movies WHERE id = #{id}
    </select>


    <select id="selectInIds" resultMap="VmMoviesMap">
        SELECT
        <include refid="BASE_ALL_CLOUM"/>
        FROM
        vm_movies
        WHERE id IN
        <foreach item="item" index="index" collection="list" open="(" separator="," close=")">
            #{item}
        </foreach>
    </select>


    <select id="selectIdList" resultType="java.lang.Long">
        SELECT
 		 id 
        FROM
        vm_movies
        <include refid="queryCondition" />

    </select>


	<select id="selectBy" resultMap="VmMoviesMap">
		SELECT * 
		FROM
		vm_movies
		<include refid="queryCondition" />
	</select>


	<select id="selectOneBy" resultMap="VmMoviesMap">
		SELECT * 
		FROM
		vm_movies
		<include refid="queryCondition" />
		LIMIT 1 
	</select>

</mapper>